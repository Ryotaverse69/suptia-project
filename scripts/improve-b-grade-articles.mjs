#!/usr/bin/env node

/**
 * B評価記事の改善スクリプト
 *
 * 対象: L-カルニチン、アスタキサンチン、ウコン、ギンコ、クレアチン
 * 追加内容: benefits, foodSources, description拡充
 */

import { createClient } from '@sanity/client';
import { readFileSync } from 'fs';
import { fileURLToPath } from 'url';
import { dirname, join } from 'path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// 環境変数読み込み
const envPath = join(__dirname, '../apps/web/.env.local');
const envContent = readFileSync(envPath, 'utf8');

const SANITY_API_TOKEN = envContent.match(/SANITY_API_TOKEN=(.+)/)?.[1]?.trim();

if (!SANITY_API_TOKEN) {
  console.error('❌ SANITY_API_TOKEN が見つかりません');
  process.exit(1);
}

// Sanity設定
const SANITY_PROJECT_ID = 'fny3jdcg';
const SANITY_DATASET = 'production';

const client = createClient({
  projectId: SANITY_PROJECT_ID,
  dataset: SANITY_DATASET,
  apiVersion: '2024-01-01',
  useCdn: false,
  token: SANITY_API_TOKEN,
});

// 改善データ
const improvements = {
  'ingredient-l-carnitine': {
    name: 'L-カルニチン',
    description: 'L-カルニチンは、必須アミノ酸のリジンとメチオニンから体内で合成される天然のアミノ酸誘導体です。主な役割は、長鎖脂肪酸をミトコンドリア内に輸送し、エネルギー産生のためのβ酸化を促進することです。特に心臓や骨格筋など、エネルギー需要の高い組織で重要な働きをします。体内で合成されますが、加齢や特定の疾患により不足することがあり、サプリメントとして摂取することで運動パフォーマンスの向上、疲労回復、体重管理のサポートが期待されています。L-カルニチンにはL型とD型がありますが、生理活性を持つのはL型のみです。運動能力向上や脂肪燃焼効果を目的として、アスリートやダイエット中の方に人気のサプリメントです。',
    benefits: [
      '脂肪酸のミトコンドリアへの輸送を促進し、脂肪をエネルギーとして効率的に利用できるようサポートします。特に運動中の脂肪燃焼を助ける可能性があります。',
      '運動後の筋肉痛や疲労感の軽減に役立つ可能性があり、運動パフォーマンスの維持や回復をサポートします。特に持久力運動において効果が期待されています。',
      '心臓の健康維持に寄与する可能性があり、心筋のエネルギー代謝をサポートします。心不全や狭心症の補助療法として研究されています。',
      '加齢に伴うカルニチンの減少を補い、エネルギー産生能力の維持に役立つ可能性があります。高齢者の身体機能維持にも注目されています。',
      '精子の運動性と質の向上に寄与する可能性があり、男性の生殖健康をサポートすると言われています。不妊治療の補助として研究されています。',
      '脳の健康維持をサポートし、認知機能の維持に役立つ可能性があります。神経保護作用が研究されています。'
    ],
    foodSources: [
      '赤身肉（牛肉、羊肉、豚肉）',
      '鶏肉',
      '魚類（特に白身魚）',
      '牛乳・乳製品',
      'アボカド',
      '全粒穀物（少量）',
      '豆類（少量）'
    ]
  },
  'ingredient-astaxanthin': {
    name: 'アスタキサンチン',
    description: 'アスタキサンチンは、サケ、エビ、カニなどの甲殻類やヘマトコッカス藻類に含まれる天然のカロテノイド色素です。強力な抗酸化作用を持ち、ビタミンEの約1000倍、ベータカロテンの約40倍の抗酸化力があると言われています。細胞膜の内側と外側の両方で抗酸化作用を発揮できる独特な構造を持ち、活性酸素による細胞ダメージから身体を守る働きがあります。特に目の健康、肌の美容、運動後の回復、心血管の健康維持に役立つ可能性が研究されています。サケやエビが赤い色をしているのは、このアスタキサンチンによるものです。紫外線や酸化ストレスから身体を守るために、サプリメントとして注目を集めています。',
    benefits: [
      '強力な抗酸化作用により、活性酸素による細胞ダメージから身体を保護し、老化の抑制に役立つ可能性があります。ビタミンEやベータカロテンよりも強力な抗酸化力を持つと言われています。',
      '目の疲労や眼精疲労の軽減に役立つ可能性があり、パソコンやスマートフォンを長時間使用する方の目の健康維持をサポートします。',
      '紫外線による肌ダメージから保護し、肌の水分保持や弾力性の維持に寄与する可能性があります。美肌効果が期待されています。',
      '運動後の筋肉疲労や炎症の軽減に役立つ可能性があり、運動パフォーマンスと回復をサポートします。',
      '心血管の健康維持に寄与し、血流改善や血管の柔軟性維持に役立つ可能性があります。',
      '脳の健康維持をサポートし、認知機能の維持に役立つ可能性があります。神経保護作用が研究されています。'
    ],
    foodSources: [
      'サケ（特に紅鮭）',
      'エビ',
      'カニ',
      'オキアミ',
      'イクラ・筋子',
      'ヘマトコッカス藻類（サプリメント原料）',
      '鯛（少量）'
    ]
  },
  'ingredient-turmeric': {
    name: 'ウコン（ターメリック）',
    description: 'ウコン（ターメリック）は、ショウガ科の植物で、その根茎に含まれるクルクミンという黄色い色素成分が健康効果の主役です。インドのアーユルヴェーダ医学で数千年にわたり使用されてきた伝統的なハーブで、強力な抗炎症作用と抗酸化作用を持つと言われています。カレーの主要なスパイスとしても知られ、独特の風味と鮮やかな黄色が特徴です。クルクミンは、慢性炎症の軽減、関節の健康維持、消化器の健康サポート、脳機能の維持などに役立つ可能性が研究されています。ただし、クルクミン単体では吸収率が低いため、黒コショウ（ピペリン）と一緒に摂取したり、脂質と組み合わせることで吸収が向上します。肝機能のサポートや抗酸化作用を目的として、サプリメントとして広く利用されています。',
    benefits: [
      '強力な抗炎症作用を持ち、慢性炎症の軽減に役立つ可能性があります。関節炎や炎症性疾患のサポートに研究されています。',
      '強力な抗酸化作用により、活性酸素による細胞ダメージから身体を保護し、老化の抑制に寄与する可能性があります。',
      '関節の健康維持と関節痛の軽減に役立つ可能性があり、変形性関節症の症状緩和が研究されています。',
      '脳の健康維持をサポートし、認知機能の維持に役立つ可能性があります。BDNFの増加により脳の神経成長を促進すると言われています。',
      '肝臓の健康維持と解毒機能のサポートに役立つ可能性があり、肝機能の保護が期待されています。',
      '心血管の健康維持に寄与し、血管内皮機能の改善に役立つ可能性があります。',
      '消化器の健康維持をサポートし、胃腸の不快感軽減に役立つ可能性があります。'
    ],
    foodSources: [
      'ウコン（ターメリック）粉末',
      'カレー粉',
      '秋ウコン（クルクミンが最も豊富）',
      '春ウコン',
      '紫ウコン',
      'ターメリックラテ（ゴールデンミルク）',
      'インド料理・カレー'
    ]
  },
  'ingredient-ginkgo': {
    name: 'ギンコ（イチョウ葉）',
    description: 'ギンコ（イチョウ葉）は、2億年以上前から存在する「生きた化石」とも呼ばれる植物で、そのエキスは脳と血流の健康維持に役立つ可能性があるとして広く研究されています。主要な有効成分は、フラボノイドとテルペノイド（ギンコライド）で、これらが抗酸化作用と血流改善作用を持つと言われています。特に、記憶力や集中力の維持、加齢に伴う認知機能の低下の緩和、末梢循環の改善に役立つ可能性が注目されています。ヨーロッパでは医薬品として認可されており、認知症や末梢動脈疾患の治療に使用されています。抗酸化作用により、脳の神経細胞を酸化ストレスから保護し、血小板の凝集を抑制することで血流をスムーズにする働きがあると考えられています。記憶力の維持や血流改善を目的として、サプリメントとして世界中で利用されています。',
    benefits: [
      '記憶力、集中力、認知機能の維持に役立つ可能性があり、特に加齢に伴う認知機能の低下の緩和が研究されています。',
      '脳への血流を改善し、脳の酸素供給と栄養供給をサポートすると言われています。脳の健康維持に役立つ可能性があります。',
      '強力な抗酸化作用により、活性酸素による細胞ダメージから脳と身体を保護します。神経保護作用が期待されています。',
      '末梢循環の改善に役立つ可能性があり、手足の冷えや痺れの軽減をサポートします。',
      '耳鳴りやめまいの軽減に役立つ可能性があり、内耳の血流改善が期待されています。',
      '目の健康維持をサポートし、緑内障や黄斑変性症の予防に役立つ可能性が研究されています。',
      '不安感の軽減や気分の改善に役立つ可能性があり、ストレス管理をサポートします。'
    ],
    foodSources: [
      'イチョウ葉エキス（サプリメント）',
      'イチョウ葉茶',
      '※食品からの摂取は困難なため、通常はサプリメントで摂取します',
      '※イチョウの実（銀杏）には有効成分は少量のみ',
      '※生のイチョウ葉は毒性があるため食用不可'
    ]
  },
  'ingredient-creatine': {
    name: 'クレアチン',
    description: 'クレアチンは、アルギニン、グリシン、メチオニンの3つのアミノ酸から体内で合成される天然の有機化合物です。主に骨格筋に貯蔵され、高強度の短時間運動時に素早くエネルギー（ATP）を再生する役割を果たします。筋力トレーニングや高強度の運動パフォーマンスを向上させる効果が最も確立されているサプリメントの一つで、数千の研究によりその安全性と有効性が実証されています。クレアチンモノハイドレートが最も研究されており、筋肉量の増加、筋力の向上、運動パフォーマンスの改善に役立つと言われています。また、脳のエネルギー代謝をサポートし、認知機能の維持にも役立つ可能性が研究されています。ベジタリアンやヴィーガンは食事からの摂取が少ないため、特にサプリメント摂取の恩恵を受けやすいとされています。',
    benefits: [
      '筋力とパワーの向上に役立ち、高強度の短時間運動（ウェイトトレーニング、スプリントなど）のパフォーマンスを改善します。',
      '筋肉量の増加をサポートし、筋肥大を促進します。トレーニングと組み合わせることで効果が最大化されます。',
      '高強度運動時のエネルギー再生を助け、セット間の回復を早めることで、より多くのトレーニング量をこなせるようサポートします。',
      '脳のエネルギー代謝をサポートし、認知機能や記憶力の維持に役立つ可能性があります。精神的疲労の軽減にも期待されています。',
      '神経保護作用を持ち、神経変性疾患の予防に役立つ可能性が研究されています。',
      '高齢者の筋肉量維持と身体機能の保持に役立つ可能性があり、サルコペニアの予防が期待されています。',
      'ベジタリアンやヴィーガンの方の筋肉内クレアチンレベルを食肉摂取者と同等に引き上げることができます。'
    ],
    foodSources: [
      '赤身肉（牛肉、豚肉）- 1kgあたり約4-5g',
      '魚類（サケ、マグロ、ニシン）',
      '鶏肉',
      '※植物性食品にはほとんど含まれない',
      '※調理により一部が分解される',
      '※サプリメントからの摂取が最も効率的（1日3-5g）',
      '※食事だけで十分量を摂取するには大量の肉・魚が必要'
    ]
  }
};

async function improveArticles() {
  console.log('🚀 B評価記事の改善を開始します...\n');

  let successCount = 0;
  let errorCount = 0;

  try {
    for (const [ingredientId, data] of Object.entries(improvements)) {
      try {
        // 現在のデータを取得
        const current = await client.fetch(`
          *[_id == $id][0] {
            name,
            description
          }
        `, { id: ingredientId });

        if (!current) {
          console.log(`   ⚠️  ${ingredientId}: 見つかりませんでした`);
          errorCount++;
          continue;
        }

        console.log(`📝 ${data.name}を改善中...`);
        console.log(`   現在のdescription: ${current.description?.length || 0}文字`);
        console.log(`   改善後のdescription: ${data.description.length}文字`);
        console.log(`   benefits追加: ${data.benefits.length}件`);
        console.log(`   foodSources追加: ${data.foodSources.length}件`);

        // 更新
        await client
          .patch(ingredientId)
          .set({
            description: data.description,
            benefits: data.benefits,
            foodSources: data.foodSources
          })
          .commit();

        console.log(`   ✅ ${data.name}: 更新完了\n`);
        successCount++;
      } catch (error) {
        console.log(`   ❌ ${ingredientId}: エラー - ${error.message}\n`);
        errorCount++;
      }
    }

    console.log('═══════════════════════════════════════════════════');
    console.log('              改善完了サマリー');
    console.log('═══════════════════════════════════════════════════');
    console.log(`✅ 成功: ${successCount}件`);
    console.log(`❌ エラー: ${errorCount}件`);

    console.log('\n🎉 B評価記事の改善が完了しました！');
    console.log('💡 次のステップ: 品質チェックを実行して結果を確認してください');
    console.log('   node scripts/comprehensive-quality-check.mjs');

  } catch (error) {
    console.error('❌ エラーが発生しました:', error);
    process.exit(1);
  }
}

improveArticles();
