# ãƒ©ãƒ³ã‚¯æ•´åˆæ€§ã‚·ã‚¹ãƒ†ãƒ 

Suptiaã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®å“è³ªã‚’ä¿è¨¼ã™ã‚‹è‡ªå‹•åŒ–ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

## æ¦‚è¦

ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã‚’æ¡ç”¨ã—ã€æˆåˆ†ã‚°ãƒ«ãƒ¼ãƒ—å†…ã§ã®ç›¸å¯¾è©•ä¾¡ã«ã‚ˆã£ã¦å…¬æ­£ãªãƒ©ãƒ³ã‚¯ä»˜ã‘ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚

## ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### 1. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

**`scripts/quick-validate.mjs`**

- å…¨å•†å“ã®ãƒ©ãƒ³ã‚¯æ•´åˆæ€§ã‚’ãƒã‚§ãƒƒã‚¯
- ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«å¯¾å¿œ
- ä»¥ä¸‹ã®å•é¡Œã‚’æ¤œå‡ºï¼š
  - tierRatingsæœªè¨­å®š
  - ç„¡åŠ¹ãªãƒ©ãƒ³ã‚¯å€¤
  - ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ãƒ¬ãƒ™ãƒ«ä¸ä¸€è‡´
  - S+ãƒ©ãƒ³ã‚¯ã®æ•´åˆæ€§
  - ç•°å¸¸ãªä¾¡æ ¼å€¤

**å®Ÿè¡Œæ–¹æ³•:**

```bash
npm run validate:ranks
```

### 2. è‡ªå‹•ä¿®æ­£ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

**`scripts/fix-all-rank-issues.mjs`**

- ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã®å•é¡Œã‚’è‡ªå‹•ä¿®æ­£
- 3ã‚¹ãƒ†ãƒƒãƒ—ãƒ—ãƒ­ã‚»ã‚¹ï¼š
  1. ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ãƒ¬ãƒ™ãƒ«çµ±ä¸€ï¼ˆevidenceLevelãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å‰Šé™¤ï¼‰
  2. ã‚¹ã‚³ã‚¢ãƒ»ãƒ©ãƒ³ã‚¯ä¸æ•´åˆä¿®æ­£
  3. tierRatingsæœªè¨­å®šå•†å“ã¸ã®åˆæœŸå€¤è¨­å®š

**å®Ÿè¡Œæ–¹æ³•:**

```bash
# ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ï¼ˆä¿®æ­£ãªã—ï¼‰
node scripts/fix-all-rank-issues.mjs

# å®Ÿéš›ã«ä¿®æ­£ã‚’é©ç”¨
npm run validate:ranks:fix
```

### 3. Tierãƒ©ãƒ³ã‚¯è¨ˆç®—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

**`scripts/auto-calculate-tier-ranks.mjs`**

- ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã®æ­£ç¢ºãªãƒ©ãƒ³ã‚¯è¨ˆç®—
- æˆåˆ†ã‚°ãƒ«ãƒ¼ãƒ—å†…ã§ã®ç›¸å¯¾è©•ä¾¡
- 5ã¤ã®è©•ä¾¡è»¸ï¼š
  - ğŸ’° ä¾¡æ ¼ãƒ©ãƒ³ã‚¯
  - ğŸ’¡ ã‚³ã‚¹ãƒ‘ãƒ©ãƒ³ã‚¯
  - ğŸ“Š å«æœ‰é‡ãƒ©ãƒ³ã‚¯
  - ğŸ”¬ ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ãƒ©ãƒ³ã‚¯
  - ğŸ›¡ï¸ å®‰å…¨æ€§ãƒ©ãƒ³ã‚¯
  - â­ ç·åˆãƒ©ãƒ³ã‚¯

**å®Ÿè¡Œæ–¹æ³•:**

```bash
# ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰
npm run calculate:tier-ranks

# å®Ÿéš›ã«æ›´æ–°
npm run calculate:tier-ranks:fix
```

## ãƒ¯ãƒ³ã‚³ãƒãƒ³ãƒ‰ä¿®æ­£

å…¨ã¦ã®ä¿®æ­£ã‚’ä¸€æ‹¬å®Ÿè¡Œï¼š

```bash
npm run ranks:fix-all
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ä»¥ä¸‹ã‚’é †ç•ªã«å®Ÿè¡Œã—ã¾ã™ï¼š

1. `fix-all-rank-issues.mjs --fix` - ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ä¿®æ­£
2. `auto-calculate-tier-ranks.mjs --fix` - Tierãƒ©ãƒ³ã‚¯å†è¨ˆç®—
3. `quick-validate.mjs` - æœ€çµ‚ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

## GitHub Actionsè‡ªå‹•åŒ–

### å®šæœŸå®Ÿè¡Œ

æ¯æ—¥åˆå‰9æ™‚ï¼ˆJSTï¼‰ã«è‡ªå‹•çš„ã«ãƒ©ãƒ³ã‚¯æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

### æ‰‹å‹•å®Ÿè¡Œ

GitHub Actionsãƒšãƒ¼ã‚¸ã‹ã‚‰æ‰‹å‹•ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã§ãã¾ã™ï¼š

1. https://github.com/[your-repo]/actions/workflows/rank-integrity-check.yml
2. ã€ŒRun workflowã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã€Œè‡ªå‹•ä¿®æ­£ã‚’å®Ÿè¡Œã€ã‚’ONã«ã™ã‚‹ã¨ã€å•é¡Œã‚’è‡ªå‹•ä¿®æ­£ã—ã¾ã™

### ç›£è¦–å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«

ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤‰æ›´ã•ã‚Œã‚‹ã¨ã€è‡ªå‹•çš„ã«ãƒã‚§ãƒƒã‚¯ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ï¼š

- `scripts/auto-calculate-tier-ranks.mjs`
- `scripts/quick-validate.mjs`
- `scripts/fix-all-rank-issues.mjs`
- `apps/web/src/lib/tier-ranking.ts`
- `apps/web/src/lib/badges*.ts`

## ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«ã¤ã„ã¦

### ä»•çµ„ã¿

å¾“æ¥ã®çµ¶å¯¾ã‚¹ã‚³ã‚¢ãƒ™ãƒ¼ã‚¹ï¼ˆä¾‹ï¼š90ç‚¹ä»¥ä¸Š=Sãƒ©ãƒ³ã‚¯ï¼‰ã§ã¯ãªãã€æˆåˆ†ã‚°ãƒ«ãƒ¼ãƒ—å†…ã§ã®ç›¸å¯¾çš„ãªé †ä½ã§ãƒ©ãƒ³ã‚¯ã‚’æ±ºå®šã—ã¾ã™ã€‚

**ä¾‹ï¼šãƒ“ã‚¿ãƒŸãƒ³Cå•†å“ã®å®‰å…¨æ€§ãƒ©ãƒ³ã‚¯**

| å•†å“  | å®‰å…¨æ€§ã‚¹ã‚³ã‚¢ | ã‚°ãƒ«ãƒ¼ãƒ—å†…é †ä½ | ãƒ©ãƒ³ã‚¯ |
| ----- | ------------ | -------------- | ------ |
| å•†å“A | 95           | ä¸Šä½10%        | S      |
| å•†å“B | 90           | ä¸Šä½30%        | A      |
| å•†å“C | 90           | ä¸‹ä½10%        | D      |

å•†å“Bã¨å•†å“Cã¯åŒã˜ã‚¹ã‚³ã‚¢90ã§ã‚‚ã€ã‚°ãƒ«ãƒ¼ãƒ—å†…ã§ã®é †ä½ã«ã‚ˆã£ã¦ãƒ©ãƒ³ã‚¯ãŒç•°ãªã‚Šã¾ã™ã€‚

### ãƒ¡ãƒªãƒƒãƒˆ

1. **å…¬æ­£ãªæ¯”è¼ƒ**: åŒã˜ã‚«ãƒ†ã‚´ãƒªå†…ã§ã®ç›¸å¯¾è©•ä¾¡
2. **å¸‚å ´ã®å¤‰åŒ–ã«å¯¾å¿œ**: æ–°å•†å“è¿½åŠ ã§è‡ªå‹•çš„ã«å†è©•ä¾¡
3. **ãƒ©ãƒ³ã‚¯ã®åˆ†æ•£**: Sã€œDã®ãƒ©ãƒ³ã‚¯ãŒé©åˆ‡ã«åˆ†å¸ƒ

### æ³¨æ„ç‚¹

- ã‚¹ã‚³ã‚¢90ã§ã‚‚Dãƒ©ãƒ³ã‚¯ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼ˆã‚°ãƒ«ãƒ¼ãƒ—å†…ã§ä¸‹ä½ã®å ´åˆï¼‰
- ã“ã‚Œã¯**ãƒã‚°ã§ã¯ãªãæ„å›³ã—ãŸå‹•ä½œ**ã§ã™
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã“ã®ä»•çµ„ã¿ã«å¯¾å¿œã—ã¦ã„ã¾ã™

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§å•é¡ŒãŒæ¤œå‡ºã•ã‚ŒãŸå ´åˆ

```bash
# 1. è©³ç´°ã‚’ç¢ºèª
npm run validate:ranks

# 2. è‡ªå‹•ä¿®æ­£ã‚’å®Ÿè¡Œ
npm run ranks:fix-all

# 3. çµæœã‚’ç¢ºèª
npm run validate:ranks
```

### ãƒ©ãƒ³ã‚¯ãŒæœŸå¾…ã¨ç•°ãªã‚‹å ´åˆ

ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã§ã¯ã€ã‚¹ã‚³ã‚¢ã¨ãƒ©ãƒ³ã‚¯ãŒç›´æ¥å¯¾å¿œã—ã¾ã›ã‚“ã€‚æˆåˆ†ã‚°ãƒ«ãƒ¼ãƒ—å†…ã§ã®é †ä½ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

```bash
# ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã§è©³ç´°ã‚’ç¢ºèª
node scripts/auto-calculate-tier-ranks.mjs
```

### æ–°å•†å“è¿½åŠ å¾Œ

æ–°å•†å“ã‚’è¿½åŠ ã—ãŸå¾Œã¯ã€å¿…ãšãƒ©ãƒ³ã‚¯å†è¨ˆç®—ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š

```bash
npm run calculate:tier-ranks:fix
```

## ç¶™ç¶šçš„ãªå“è³ªä¿è¨¼

### æ¨å¥¨ãƒ•ãƒ­ãƒ¼

1. **æ–°å•†å“è¿½åŠ æ™‚**: `npm run calculate:tier-ranks:fix`
2. **ä¾¡æ ¼æ›´æ–°æ™‚**: `npm run calculate:tier-ranks:fix`
3. **å®šæœŸãƒã‚§ãƒƒã‚¯**: GitHub Actionsã§è‡ªå‹•å®Ÿè¡Œï¼ˆæ¯æ—¥ï¼‰
4. **æ‰‹å‹•ç¢ºèª**: `npm run validate:ranks`

### ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

- å•†å“ãƒ‡ãƒ¼ã‚¿å¤‰æ›´å¾Œã¯å¿…ãšãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
- è‡ªå‹•ä¿®æ­£ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä¿¡é ¼ã§ãã¾ã™ãŒã€çµæœã¯ç¢ºèªã™ã‚‹
- ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã®ä»•çµ„ã¿ã‚’ç†è§£ã™ã‚‹
- GitHub Actionsã®ãƒ­ã‚°ã‚’å®šæœŸçš„ã«ç¢ºèª

## æŠ€è¡“è©³ç´°

### ãƒ©ãƒ³ã‚¯è¨ˆç®—å¼

```javascript
// ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«è¨ˆç®—
function calculatePercentile(value, values, lowerIsBetter = false) {
  const sortedValues = [...values].sort((a, b) => a - b);
  const index = sortedValues.findIndex((v) => v >= value);
  const percentile = (index / sortedValues.length) * 100;
  return lowerIsBetter ? 100 - percentile : percentile;
}

// ãƒ©ãƒ³ã‚¯å¤‰æ›
function scoreToRank(percentile) {
  if (percentile >= 90) return "S";
  if (percentile >= 80) return "A";
  if (percentile >= 70) return "B";
  if (percentile >= 60) return "C";
  return "D";
}
```

### 5å† é”æˆï¼ˆS+ãƒ©ãƒ³ã‚¯ï¼‰

å…¨ã¦ã®è©•ä¾¡è»¸ã§Sãƒ©ãƒ³ã‚¯ã‚’ç²å¾—ã—ãŸå•†å“ã¯ã€ç‰¹åˆ¥ãªã€ŒS+ã€ç·åˆãƒ©ãƒ³ã‚¯ã‚’ç²å¾—ã—ã¾ã™ã€‚

```javascript
const isFiveCrown =
  priceRank === "S" &&
  costEffectivenessRank === "S" &&
  contentRank === "S" &&
  evidenceRank === "S" &&
  safetyRank === "S";

const overallRank = isFiveCrown ? "S+" : scoreToRank(overallScore);
```

## æ›´æ–°å±¥æ­´

| æ—¥ä»˜       | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å†…å®¹                               |
| ---------- | ---------- | ---------------------------------- |
| 2025-11-11 | v2.0.0     | ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ©ãƒ³ã‚­ãƒ³ã‚°å®Ÿè£… |
| 2025-11-11 | v2.1.0     | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ æ”¹å–„         |
| 2025-11-11 | v2.2.0     | GitHub Actionsçµ±åˆ                 |

---

**æœ€çµ‚æ›´æ–°**: 2025-11-11
**ç®¡ç†è€…**: Suptiaé–‹ç™ºãƒãƒ¼ãƒ 
