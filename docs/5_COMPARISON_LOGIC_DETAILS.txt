================================================================================
Suptia 5つの比較ロジック詳細仕様書
================================================================================

最終更新: 2025-11-16
バージョン: v2.0.0 (Phase 1/2/2.7/3完了版)
商品数: 336件
テスト: 224/224 PASS

================================================================================
📋 目次
================================================================================

1. 価格比較ロジック
2. コスパ比較ロジック
3. 含有量比較ロジック
4. エビデンス比較ロジック
5. 安全性比較ロジック
6. カテゴリ別重み付けマトリクス
7. 統合ランキングシステム

================================================================================
1. 💰 価格比較ロジック
================================================================================

概要:
  複数ECサイト（楽天、Yahoo!、Amazon、iHerb）の価格を取得し、最安値を判定。
  実効価格（送料・ポイント還元を考慮）を計算して、真のコストを比較。

--------------------------------------------------------------------------------
1.1 価格取得
--------------------------------------------------------------------------------

データソース:
  - 楽天市場API (実装済み、30商品)
  - Yahoo!ショッピングAPI (実装済み、20商品)
  - Amazon PA-API (2026年1月予定)
  - iHerb (CJ Affiliate経由、2026年1月予定)

取得データ:
  {
    source: "rakuten" | "yahoo" | "amazon" | "iherb",
    amount: number,              // 表示価格（円）
    currency: "JPY",
    url: string,                 // アフィリエイトリンク
    fetchedAt: string,           // 取得日時（ISO 8601）
    confidence: number,          // 0.0-1.0（マッチング精度）

    // 実質価格関連
    shippingFee?: number,        // 送料（円）
    pointRate?: number,          // ポイント還元率（0.01 = 1%）
    isFreeShipping?: boolean,    // 送料無料フラグ
    effectivePrice?: number,     // 実質価格（計算後）
    pointAmount?: number,        // ポイント還元額（計算後）

    // 在庫状況
    stockStatus?: "in_stock" | "low_stock" | "out_of_stock" | "unknown"
  }

実装ファイル:
  - apps/web/src/components/PriceComparison.tsx
  - apps/web/src/lib/ec-adapters/rakuten.ts
  - apps/web/src/lib/ec-adapters/yahoo.ts

--------------------------------------------------------------------------------
1.2 実効価格計算
--------------------------------------------------------------------------------

計算式:
  effectivePrice = amount + shippingFee - pointAmount
  pointAmount = amount × pointRate

例:
  楽天市場: ¥1,000、送料¥500、ポイント5%
  → effectivePrice = 1000 + 500 - (1000 × 0.05) = ¥1,450

考慮要素:
  ✓ 表示価格
  ✓ 送料（無料配送の場合は0円）
  ✓ ポイント還元（楽天ポイント、PayPayポイントなど）
  ✗ クーポン（データ取得困難のため未対応）
  ✗ セール価格（リアルタイム対応のみ）

--------------------------------------------------------------------------------
1.3 最安値判定
--------------------------------------------------------------------------------

判定基準:
  1. 在庫あり（stockStatus = "in_stock"）
  2. 実効価格が最も低い
  3. 信頼度スコア（confidence）≥ 0.9

バッジ付与条件:
  💰 最安値バッジ:
    - 複数ECサイト中で実効価格が最も安い
    - 在庫状況: in_stock
    - 最新データ（取得日から7日以内）

実装ファイル:
  - apps/web/src/lib/badges.ts (evaluateBadges関数)

--------------------------------------------------------------------------------
1.4 価格履歴トラッキング
--------------------------------------------------------------------------------

データ構造:
  {
    source: string,
    amount: number,
    recordedAt: string,  // ISO 8601
  }

機能:
  - 価格変動の記録（毎日深夜3時に自動同期）
  - 価格履歴グラフ表示（PriceHistoryChart.tsx）
  - 価格アラート機能（Phase 4で実装予定）

保存期間: 180日

実装ファイル:
  - apps/web/src/components/PriceHistoryChart.tsx
  - scripts/sync-rakuten-products.mjs
  - scripts/sync-yahoo-products.mjs

================================================================================
2. 💡 コスパ比較ロジック
================================================================================

概要:
  成分量あたりの価格（¥/mg）を計算し、コストパフォーマンスを評価。
  マルチビタミン商品は「トップ5方式」で公平に比較。

--------------------------------------------------------------------------------
2.1 基本計算式
--------------------------------------------------------------------------------

単一成分商品:
  costPerMg = pricePerDay ÷ (主成分のmg量/日)
  pricePerDay = 商品価格 ÷ (servingsPerContainer ÷ servingsPerDay)

例:
  DHC ビタミンC 60日分
  - 価格: ¥398
  - 内容量: 120粒（60日分、1日2粒）
  - ビタミンC含有量: 1000mg/日
  → pricePerDay = 398 ÷ 60 = ¥6.63/日
  → costPerMg = 6.63 ÷ 1000 = ¥0.00663/mg

--------------------------------------------------------------------------------
2.2 マルチビタミン対応（トップ5方式）
--------------------------------------------------------------------------------

判定基準:
  成分数 > 3 → マルチビタミンと判定

計算方法:
  1. 全成分をmg量でソート（降順）
  2. トップ5成分のみを抽出
  3. トップ5のmg量合計でコスト計算

理由:
  - 微量成分（ビオチン、セレンなど）の水増し対策
  - 実質的な価値を正確に反映
  - ユーザーの直感と一致

例:
  Fancl マルチビタミン（19成分）
  - 全成分合計: 1500mg/日
  - トップ5合計: 1200mg/日（ビタミンC 500mg、カルシウム 300mg、...）
  → トップ5のみで計算

実装ファイル:
  - apps/web/src/lib/cost-calculator.ts
    - isMultiVitaminProduct()
    - getTop5MajorIngredients()
    - calculateCostPerMgForMultiVitamin()

--------------------------------------------------------------------------------
2.3 パーセンタイル計算（Bessel補正）
--------------------------------------------------------------------------------

目的:
  重複値が多い場合の精度向上

計算式:
  percentile = (rank - 0.5) / n × 100

  rank: ソート後の順位（1から開始）
  n: グループ内の総数

理由:
  - 標準的なパーセンタイル計算では重複値の扱いが不正確
  - Bessel補正により、重複値が多い場合でも適切な順位付け

例:
  コスパデータ: [10, 15, 15, 15, 20, 25]（6商品）

  商品A（15円/mg）の場合:
    - rank = 3（同率2位の中央）
    - percentile = (3 - 0.5) / 6 × 100 = 41.67%

実装ファイル:
  - scripts/auto-calculate-tier-ranks.mjs
    - calculatePercentile()

--------------------------------------------------------------------------------
2.4 ランク判定
--------------------------------------------------------------------------------

パーセンタイル → ランク変換:
  S: percentile ≥ 90%
  A: percentile ≥ 75%
  B: percentile ≥ 50%
  C: percentile ≥ 25%
  D: percentile < 25%

バッジ付与条件:
  💡 ベストバリューバッジ:
    - コスパランク = S
    - 同一成分グループ内で最も優れたコスパ

実装ファイル:
  - apps/web/src/lib/tier-ranking.ts
  - apps/web/src/lib/badges.ts

================================================================================
3. 📊 含有量比較ロジック
================================================================================

概要:
  1日あたりの成分含有量（mg/日）を比較し、成分量の多さを評価。
  同一成分グループ内でパーセンタイル順位を算出。

--------------------------------------------------------------------------------
3.1 含有量計算
--------------------------------------------------------------------------------

基本計算式:
  dailyAmount = amountMgPerServing × servingsPerDay

例:
  DHC ビタミンC
  - 1粒あたり: 500mg
  - 1日の摂取量: 2粒
  → dailyAmount = 500 × 2 = 1000mg/日

--------------------------------------------------------------------------------
3.2 成分グループ化
--------------------------------------------------------------------------------

グループ化基準:
  - 成分名の正規化（ingredient-normalizer.mjs）
  - エイリアス辞書（ingredient-aliases.json、56成分）

例:
  "ビタミンC" = "Vitamin C" = "アスコルビン酸"
  → すべて「ビタミンC（アスコルビン酸）」グループ

実装ファイル:
  - scripts/ingredient-normalizer.mjs
  - apps/web/src/data/ingredient-aliases.json

--------------------------------------------------------------------------------
3.3 パーセンタイル計算
--------------------------------------------------------------------------------

同一成分グループ内での順位計算:
  percentile = (rank - 0.5) / n × 100

例:
  ビタミンCグループ（71商品）
  - 商品A: 1000mg/日 → rank 15
  → percentile = (15 - 0.5) / 71 × 100 = 20.42%

--------------------------------------------------------------------------------
3.4 ランク判定とバッジ
--------------------------------------------------------------------------------

ランク:
  S: percentile ≥ 90%
  A: percentile ≥ 75%
  B: percentile ≥ 50%
  C: percentile ≥ 25%
  D: percentile < 25%

📊 最高含有量バッジ:
  - 含有量ランク = S
  - 同一成分グループ内で最も多い含有量

--------------------------------------------------------------------------------
3.5 安全性チェック（UL判定）
--------------------------------------------------------------------------------

耐容上限量（UL: Tolerable Upper Intake Level）:
  - 厚生労働省「日本人の食事摂取基準」を参照
  - UL超過商品には警告表示

例:
  ビタミンD:
    - RDA（推奨量）: 8.5μg/日
    - UL（上限量）: 100μg/日
    - 含有量: 120μg/日 → ⚠️ UL超過警告

実装ファイル:
  - apps/web/src/data/rda-standards.json
  - apps/web/src/components/IngredientComparison.tsx

警告表示:
  ⚠️ 耐容上限量（UL）超過の可能性
  注意: 成分の化学形態や換算方法により、実際の安全性評価は異なる場合があります。
  長期的な摂取を検討される場合は、必ず医師または栄養士にご相談ください。

================================================================================
4. 🔬 エビデンス比較ロジック
================================================================================

概要:
  科学的根拠の強さを評価し、エビデンススコア（0-100点）を算出。
  マルチビタミンは「トップ5方式」で公平に評価。

--------------------------------------------------------------------------------
4.1 エビデンスレベル定義
--------------------------------------------------------------------------------

Suptia独自基準:
  S: 大規模RCTやメタ解析による高い信頼性
     例: ビタミンDと骨密度改善
     スコア: 100点

  A: 良質な研究で効果が確認
     例: EPA/DHAと中性脂肪低下
     スコア: 80点

  B: 限定的研究・条件付きの効果
     例: マグネシウムと睡眠改善
     スコア: 60点

  C: 動物実験・小規模試験レベル
     例: アスタキサンチンと疲労改善
     スコア: 40点

  D: 理論・未検証レベル
     例: 未確認ハーブ抽出物
     スコア: 20点

参考基準:
  - PubMed掲載論文数
  - Cochrane Review評価
  - 厚生労働省ガイドライン
  - 各国の健康食品規制

実装ファイル:
  - apps/web/src/lib/auto-scoring.ts
    - evidenceLevelToScore()
    - scoreToEvidenceLevel()

--------------------------------------------------------------------------------
4.2 エビデンススコア計算
--------------------------------------------------------------------------------

単一成分商品:
  evidenceScore = 成分のエビデンスレベルスコア

マルチビタミン商品（トップ5方式）:
  1. 全成分をmg量でソート（降順）
  2. トップ5成分のみを抽出
  3. mg量に基づく加重平均を計算

計算式:
  evidenceScore = Σ(成分iのスコア × 成分iの重み) / Σ(成分iの重み)

  成分iの重み = 成分iの日次mg量 / トップ5のmg量合計

例:
  Fancl マルチビタミン（トップ5）
  - ビタミンC: 500mg、スコア80 → 重み: 500/1200 = 0.417
  - カルシウム: 300mg、スコア80 → 重み: 300/1200 = 0.250
  - マグネシウム: 200mg、スコア80 → 重み: 200/1200 = 0.167
  - ビタミンD: 100mg、スコア100 → 重み: 100/1200 = 0.083
  - ビタミンE: 100mg、スコア80 → 重み: 100/1200 = 0.083

  evidenceScore = (80×0.417 + 80×0.250 + 80×0.167 + 100×0.083 + 80×0.083)
                = 81.66点

実装ファイル:
  - scripts/auto-calculate-tier-ranks.mjs
    - calculateProductScores(ingredients, servingsPerDay, isMultiVitamin)

--------------------------------------------------------------------------------
4.3 ランク判定
--------------------------------------------------------------------------------

エビデンススコア → ランク変換:
  S: score ≥ 90点
  A: score ≥ 75点
  B: score ≥ 60点
  C: score ≥ 45点
  D: score < 45点

🔬 エビデンスSバッジ:
  - エビデンススコア ≥ 90点
  - 最高レベルの科学的根拠

実装ファイル:
  - apps/web/src/lib/tier-colors.ts
    - scoreToTierRank()

================================================================================
5. 🛡️ 安全性比較ロジック
================================================================================

概要:
  成分の安全性を多角的に評価し、安全性スコア（0-100点）を算出。
  薬機法コンプライアンスチェックと連携。

--------------------------------------------------------------------------------
5.1 安全性スコア計算
--------------------------------------------------------------------------------

評価要素:
  1. UL（耐容上限量）に対する比率
  2. 副作用の報告頻度
  3. 相互作用のリスク
  4. 妊娠中・授乳中の安全性
  5. 長期摂取の安全性

計算式（マルチビタミンはトップ5方式）:
  safetyScore = Σ(成分iの安全性スコア × 成分iの重み) / Σ(成分iの重み)

UL比率による減点:
  - UL未満: 100点
  - ULの50-100%: 80点
  - ULの100-150%: 60点
  - ULの150-200%: 40点
  - UL超過200%以上: 20点

例:
  ビタミンA:
    - 含有量: 800μg/日
    - UL: 2700μg/日
    - UL比率: 800/2700 = 29.6% → 100点

  ビタミンD:
    - 含有量: 120μg/日
    - UL: 100μg/日
    - UL比率: 120/100 = 120% → 60点（⚠️警告表示）

実装ファイル:
  - scripts/auto-calculate-tier-ranks.mjs
    - calculateProductScores()

--------------------------------------------------------------------------------
5.2 副作用・相互作用チェック
--------------------------------------------------------------------------------

データソース:
  - 厚生労働省「健康食品の安全性・有効性情報」
  - National Institutes of Health (NIH)
  - 医薬品との相互作用データベース

チェック項目:
  ✓ 一般的な副作用（胃腸障害、頭痛など）
  ✓ アレルギー反応
  ✓ 医薬品との相互作用
  ✓ 妊娠中・授乳中の禁忌
  ✓ 特定疾患患者への注意

実装ファイル:
  - apps/web/src/components/EvidenceSafetyDetail.tsx

--------------------------------------------------------------------------------
5.3 薬機法コンプライアンスチェック
--------------------------------------------------------------------------------

チェッカー機能:
  - 150+ルールの自動チェック
  - カテゴリ別分類（8カテゴリ）
  - 重大度別スコアリング（4段階）

ルールカテゴリ:
  1. medical_effect（医薬品的効能効果）
  2. disease_treatment（疾病の治療・予防）
  3. exaggeration（誇大広告）
  4. guarantee（保証表現）
  5. superlative（最上級表現）
  6. safety_claim（安全性の保証）
  7. body_structure（身体の組織機能の変化）
  8. speed_claim（速効性・即効性）

重大度:
  - critical: 絶対禁止（例: 「がんが治る」）
  - high: 強く推奨しない（例: 「効く」）
  - medium: 避けるべき（例: 「症状」）
  - low: 注意喚起（例: 「健康的」）

例:
  NG表現: "糖尿病を治す"
  → critical違反
  → 代替表現: "血糖値の健康維持に"

コンプライアンススコア計算:
  score = 100 - (違反による減点合計)

  減点:
    - critical: -30点
    - high: -15点
    - medium: -7点
    - low: -3点

リスクレベル判定:
  - safe: score ≥ 95点
  - low: score ≥ 85点
  - medium: score ≥ 70点
  - high: score ≥ 50点
  - critical: score < 50点

実装ファイル:
  - apps/web/src/lib/compliance/checker.ts
  - apps/web/src/lib/compliance/rules.ts

自動修正機能:
  - autoFixViolations()関数
  - NG表現を自動的にOK表現に置換
  - 修正履歴の保存

--------------------------------------------------------------------------------
5.4 ランク判定とバッジ
--------------------------------------------------------------------------------

安全性スコア → ランク変換:
  S: score ≥ 90点
  A: score ≥ 75点
  B: score ≥ 60点
  C: score ≥ 45点
  D: score < 45点

🛡️ 高安全性バッジ:
  - 安全性スコア ≥ 90点
  - UL超過なし
  - 重大な副作用報告なし
  - 薬機法コンプライアンススコア ≥ 95点

================================================================================
6. ⚖️ カテゴリ別重み付けマトリクス
================================================================================

概要:
  成分のカテゴリに応じて、5軸の評価重みを最適化。
  水溶性ビタミンは「含有量」、脂溶性ビタミンは「安全性」を重視など。

--------------------------------------------------------------------------------
6.1 カテゴリ定義
--------------------------------------------------------------------------------

1. 水溶性ビタミン:
   - 対象: ビタミンB群、ビタミンC、葉酸、ビオチン
   - 特性: 過剰摂取しても尿として排出
   - 重視: 含有量、コスパ

   重み:
     priceWeight: 0.15
     costEffectivenessWeight: 0.25
     contentWeight: 0.30  ← 最重視
     evidenceWeight: 0.20
     safetyWeight: 0.10   ← 最低

2. 脂溶性ビタミン:
   - 対象: ビタミンA、D、E、K
   - 特性: 体内蓄積される、過剰摂取リスク
   - 重視: 安全性

   重み:
     priceWeight: 0.15
     costEffectivenessWeight: 0.20
     contentWeight: 0.20
     evidenceWeight: 0.20
     safetyWeight: 0.25   ← 最重視

3. ミネラル:
   - 対象: カルシウム、マグネシウム、鉄、亜鉛、セレン
   - 特性: 過不足いずれも問題
   - 重視: バランス

   重み:
     priceWeight: 0.15
     costEffectivenessWeight: 0.25
     contentWeight: 0.20
     evidenceWeight: 0.20
     safetyWeight: 0.20   ← バランス型

4. 機能性成分:
   - 対象: オメガ3、プロバイオティクス、CoQ10、ルテイン
   - 特性: 効果に個人差、品質（菌株、抽出方法）が重要
   - 重視: エビデンス

   重み:
     priceWeight: 0.10
     costEffectivenessWeight: 0.20
     contentWeight: 0.20
     evidenceWeight: 0.35  ← 最重視
     safetyWeight: 0.15

5. アミノ酸:
   - 対象: BCAA、グルタミン、アルギニン、シトルリン
   - 特性: 摂取量が多い、安全性リスク低い
   - 重視: コスパ、含有量

   重み:
     priceWeight: 0.15
     costEffectivenessWeight: 0.30  ← 最重視
     contentWeight: 0.25
     evidenceWeight: 0.20
     safetyWeight: 0.10

6. マルチビタミン:
   - 対象: 複数成分を含む総合栄養補助食品
   - 特性: 総合的なバランスが重要
   - 重視: コスパ、含有量

   重み:
     priceWeight: 0.15
     costEffectivenessWeight: 0.30  ← 最重視
     contentWeight: 0.25
     evidenceWeight: 0.15
     safetyWeight: 0.15

7. その他:
   - 対象: 上記カテゴリに分類されない成分
   - 重視: 均等評価

   重み:
     priceWeight: 0.20
     costEffectivenessWeight: 0.20
     contentWeight: 0.20
     evidenceWeight: 0.20
     safetyWeight: 0.20   ← 全て均等

実装ファイル:
  - apps/web/src/data/category-weights.json
  - apps/web/src/data/ingredient-category-mapping.json

--------------------------------------------------------------------------------
6.2 成分カテゴリ判定ロジック
--------------------------------------------------------------------------------

判定手順:
  1. 成分名を正規化（ingredient-normalizer.mjs）
  2. ingredient-category-mapping.jsonで照合
  3. 完全一致または部分一致でカテゴリ判定
  4. 該当なしの場合は「その他」

例:
  入力: "Vitamin C"
  → 正規化: "ビタミンC（アスコルビン酸）"
  → カテゴリ: "水溶性ビタミン"
  → 重み: contentWeight 0.30（最重視）

実装ファイル:
  - scripts/auto-calculate-tier-ranks.mjs
    - getIngredientCategory()

================================================================================
7. 📈 統合ランキングシステム
================================================================================

概要:
  5軸の評価（価格、コスパ、含有量、エビデンス、安全性）を統合し、
  カテゴリ別重み付けで総合スコアを算出。

--------------------------------------------------------------------------------
7.1 総合スコア計算
--------------------------------------------------------------------------------

計算式:
  overallScore =
    priceRank × priceWeight +
    costEffectivenessRank × costEffectivenessWeight +
    contentRank × contentWeight +
    evidenceRank × evidenceWeight +
    safetyRank × safetyWeight

ランク値換算:
  S: 100点
  A: 85点
  B: 75点
  C: 65点
  D: 50点

例（水溶性ビタミンの場合）:
  ランク:
    - 価格: B (75点)
    - コスパ: A (85点)
    - 含有量: S (100点)
    - エビデンス: A (85点)
    - 安全性: B (75点)

  重み（水溶性ビタミン）:
    - priceWeight: 0.15
    - costEffectivenessWeight: 0.25
    - contentWeight: 0.30
    - evidenceWeight: 0.20
    - safetyWeight: 0.10

  総合スコア:
    = 75×0.15 + 85×0.25 + 100×0.30 + 85×0.20 + 75×0.10
    = 11.25 + 21.25 + 30 + 17 + 7.5
    = 87点

実装ファイル:
  - scripts/auto-calculate-tier-ranks.mjs
    - calculateWeightedOverallScore()

--------------------------------------------------------------------------------
7.2 総合ランク判定
--------------------------------------------------------------------------------

総合スコア → 総合ランク変換:
  S: score ≥ 90点
  A: score ≥ 80点
  B: score ≥ 70点
  C: score ≥ 60点
  D: score < 60点

--------------------------------------------------------------------------------
7.3 5つの称号（バッジ）システム
--------------------------------------------------------------------------------

各軸で最高評価を獲得した商品には称号を付与:

💰 最安値:
  - 複数ECサイトの中で実効価格が最も安い
  - 在庫状況: in_stock

📊 最高含有量:
  - その成分の含有量が同一グループ内で最も多い
  - 含有量ランク: S

💡 ベストバリュー:
  - コスパ（成分量あたり価格）が最も優れている
  - コスパランク: S

🔬 エビデンスS:
  - エビデンススコア ≥ 90点
  - 最高レベルの科学的根拠

🛡️ 高安全性:
  - 安全性スコア ≥ 90点
  - UL超過なし

🌟 完璧なサプリメント（5冠達成）:
  - 上記5つの称号をすべて獲得
  - 特別なゴールドバッジ表示
  - アニメーション効果

実装ファイル:
  - apps/web/src/lib/badges.ts
    - evaluateBadges()
  - apps/web/src/components/ProductBadges.tsx

--------------------------------------------------------------------------------
7.4 データ更新フロー
--------------------------------------------------------------------------------

自動更新（GitHub Actions）:
  トリガー: 毎日深夜3時（JST）

  ステップ:
    1. ECサイトから最新価格取得
    2. 価格履歴に記録
    3. パーセンタイル再計算
    4. ランク再計算
    5. バッジ再判定
    6. Sanityに反映

手動更新:
  コマンド:
    node scripts/auto-calculate-tier-ranks.mjs --dry-run  # プレビュー
    node scripts/auto-calculate-tier-ranks.mjs --fix      # 実行

実装ファイル:
  - .github/workflows/sync-products.yml
  - scripts/auto-calculate-tier-ranks.mjs

================================================================================
8. 📊 実装統計（2025年11月16日現在）
================================================================================

商品データ:
  - 総商品数: 336件
  - 楽天市場: 30件
  - Yahoo!ショッピング: 20件
  - テストデータ: 286件

成分データ:
  - 成分グループ: 27グループ
  - 正規化対応成分: 56成分
  - カテゴリ: 7カテゴリ

テスト:
  - 総テスト数: 224件
  - 合格率: 100% (224/224 PASS)

薬機法ルール:
  - 総ルール数: 150+
  - カテゴリ: 8カテゴリ
  - 重大度: 4段階

更新頻度:
  - 価格データ: 毎日深夜3時（自動）
  - ランク計算: 価格更新と連動
  - バッジ判定: ランク更新と連動

================================================================================
9. 🔧 技術仕様
================================================================================

開発環境:
  - フレームワーク: Next.js 14 (App Router)
  - 言語: TypeScript
  - データベース: Sanity CMS v3
  - テスト: Vitest + Testing Library
  - CI/CD: GitHub Actions

主要ライブラリ:
  - @sanity/client: Sanityクライアント
  - zod: スキーマバリデーション
  - date-fns: 日付処理
  - recharts: グラフ描画

パフォーマンス:
  - ビルド時間: ~30秒
  - ランク計算時間: ~5秒（336商品）
  - テスト実行時間: ~10秒（224テスト）

================================================================================
10. 🚀 今後の拡張予定
================================================================================

Phase 4（2026年3月〜4月）:
  - 価格アラート機能（Supabase MCP統合）
  - マイページβ（お気に入り・診断履歴）
  - 有料会員特典（広告非表示、AI推薦）
  - アフィリエイトトラッキング統合

Phase 5（2026年後半〜）:
  - RAGベースのGPT連携
  - 自然言語クエリ対応
  - AI診断履歴の学習
  - 推薦根拠の明示（Explainable Recommendation）

拡張機能候補:
  - 化学形態別評価（吸収率考慮）
  - バイオアベイラビリティ詳細表示
  - 年齢・性別・目的別推奨量
  - パーソナライズドランク表示
  - 時系列ランク変動グラフ

================================================================================
11. 📚 参考資料
================================================================================

公的機関:
  - 厚生労働省「日本人の食事摂取基準（2020年版）」
  - 消費者庁「特定保健用食品（トクホ）」
  - 医薬品医療機器総合機構（PMDA）

学術データベース:
  - PubMed (https://pubmed.ncbi.nlm.nih.gov/)
  - Cochrane Library (https://www.cochranelibrary.com/)
  - National Institutes of Health (NIH)

業界標準:
  - Schema.org Product schema
  - Google Merchant Center仕様
  - Amazon Product Advertising API 5.0

プロジェクトドキュメント:
  - CLAUDE.md: プロジェクト全体ガイド
  - COMPARISON_LOGIC_IMPROVEMENTS.md: Phase 1/2詳細
  - MULTIVITAMIN_COST_LOGIC.md: マルチビタミン対応詳細
  - COST_PERFORMANCE_IMPROVEMENTS.md: コスパ改善詳細

================================================================================
12. 📝 更新履歴
================================================================================

v2.0.0 (2025-11-16):
  - Phase 1完了: Bessel補正パーセンタイル実装（113商品更新）
  - Phase 2完了: カテゴリ別重み付け実装（19商品更新）
  - Phase 2.7完了: マルチビタミン対応、UI/UX改善（4+3+4コンポーネント）
  - Phase 3完了: 薬機法、JSON-LD、GA4、内部リンク
  - 全336商品のランク最新化
  - 224/224テスト全合格

v1.0.0 (2025-11-14):
  - 初版リリース
  - 基本的なランク計算システム
  - 単一成分商品対応

================================================================================
END OF DOCUMENT
================================================================================

作成者: Claude Code
最終更新: 2025-11-16
バージョン: v2.0.0
商品数: 336件
テスト: 224/224 PASS
